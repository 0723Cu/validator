language: java
script:
- python ./build/build.py dldeps
- python ./build/build.py build
- python ./build/build.py check
- python ./build/build.py test
- echo "test" | python ./build/build.py jar
- java -jar ./build/dist/vnu.jar ./build/dist/index.html
- java -jar ./build/dist/vnu.jar ./site/nu-about.html
- jar xf ./build/dist/vnu.jar && file nu/validator/client/SimpleCommandLineValidator.class
  | grep "version 50.0"
- echo "test" | python ./build/build.py war
- jar xf ./build/dist/vnu.war && file WEB-INF/classes/nu/validator/servlet/VerifierServlet.class
  | grep "version 50.0"
- sudo apt-get update
- sudo apt-get install tomcat7
- sudo cp ./build/dist/vnu.war /var/lib/tomcat7/webapps
- sleep 10
- test -z "$(curl -sS 'http://localhost:8080/vnu/?out=gnu&doc=data:text/html;charset=utf-8,%3C%21doctype%20html%3E%3Cmeta%20charset%3Dutf-8%3E%3Ctitle%3ETest%3C%2Ftitle%3E')"
- test -z "$(curl -sS 'http://localhost:8080/vnu/?out=gnu&doc=data:text/html;charset=utf-8,%3C%21doctype%20htooml%3E%3Cmeta%20charset%3Dutf-8%3E%3Ctitle%3ETest%3C%2Ftitle%3E')"
